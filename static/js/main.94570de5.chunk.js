(this.webpackJsonpdsengine=this.webpackJsonpdsengine||[]).push([[0],{56:function(e,t,a){},62:function(e,t,a){},63:function(e,t,a){},69:function(e,t,a){},70:function(e,t,a){"use strict";a.r(t);var o=a(2),n=a.n(o),r=a(46),c=a.n(r),i=(a(56),a(24)),l=a(13),s=a(11),j=a(75),b=a(14),u=a(0),d=function(e){n.a.useEffect((function(){return document.addEventListener("keydown",e,!1),document.addEventListener("keyup",e,!1),function(){document.removeEventListener("keydown",e),document.removeEventListener("keyup",e)}}))},O=a(9),h=a(74),p=a(1),x="models/Floor_Modular.glb";function f(e){var t=Object(h.a)(x).nodes,a=function(){return(Math.floor(8*Math.random())-4)*Math.PI};return Object(p.jsxs)("group",Object(O.a)(Object(O.a)({name:"floor"},e),{},{children:[Object(p.jsx)("primitive",{object:t.Floor_Modular.clone(),position:[-1,-.08,-1],"rotation-y":a(),receiveShadow:!0}),Object(p.jsx)("primitive",{object:t.Floor_Modular.clone(),position:[1,-.08,-1],"rotation-y":a(),receiveShadow:!0}),Object(p.jsx)("primitive",{object:t.Floor_Modular.clone(),position:[-1,-.08,1],"rotation-y":a(),receiveShadow:!0}),Object(p.jsx)("primitive",{object:t.Floor_Modular.clone(),position:[1,-.08,1],"rotation-y":a(),receiveShaodw:!0})]}))}h.a.preload(x);var k="models/Arch.glb";function m(e){var t=Object(h.a)(k).nodes;return Object(p.jsxs)("group",Object(O.a)(Object(O.a)({name:"arch"},e),{},{children:[Object(p.jsx)("primitive",{object:t.Arch.clone(),castShadow:!0,receiveShadow:!0}),Object(p.jsx)(f,{})]}))}h.a.preload(k);var v=a(15),g="models/Column.glb",W="models/Column2.glb";function w(e){var t=Object(h.a)(g).nodes;return Object(p.jsx)("primitive",Object(O.a)({object:t.Column.clone(),castShadow:!0,receiveShadow:!0},e))}function y(e){return Object(p.jsxs)("group",Object(O.a)(Object(O.a)({name:"sqcolumn"},e),{},{children:[Object(p.jsx)(w,{}),Object(p.jsx)(f,{})]}))}function M(e){var t=Object(h.a)(W).nodes;return Object(p.jsxs)("group",Object(O.a)(Object(O.a)({name:"rncolumn"},e),{},{children:[Object(p.jsx)("primitive",{object:t.Column2.clone(),castShadow:!0,receiveShadow:!0}),Object(p.jsx)(f,{})]}))}h.a.preload(g),h.a.preload(W);var S="models/Wall_Modular.glb",B="models/WallCover_Modular.glb",I="models/Decorative_Wall.glb";function P(e){var t=e.rotation,a=Object(v.a)(e,["rotation"]),o=Object(h.a)(B).nodes,n=Object(h.a)(S).nodes,r=void 0;if(t){var c=t;r=[c[0],c[1],0]}return Object(p.jsxs)("group",Object(O.a)(Object(O.a)({},a),{},{children:[Object(p.jsx)("primitive",{object:o.WallCover_Modular.clone(),rotation:r,castShadow:!0,receiveShadow:!0}),Object(p.jsx)("primitive",{object:n.Wall_Modular.clone(),rotation:t,castShadow:!0,receiveShadow:!0})]}))}function C(e){var t=Object(h.a)(S).nodes;return Object(p.jsx)("primitive",Object(O.a)({object:t.Wall_Modular.clone(),castShadow:!0,receiveShadow:!0},e))}function D(e){var t=Object(h.a)(I).nodes;return Object(p.jsxs)("group",Object(O.a)(Object(O.a)({name:"wall-broken"},e),{},{children:[Object(p.jsx)("primitive",{object:t.Decorative_Wall.clone(),"position-y":1}),Object(p.jsx)(f,{})]}))}function F(e){var t=function(){return(Math.floor(8*Math.random())-4)*Math.PI};return Object(p.jsxs)("group",Object(O.a)(Object(O.a)({name:"wall"},e),{},{children:[Object(p.jsx)(P,{position:[-1,1,0],rotation:[0,0,t()]}),Object(p.jsx)(C,{position:[-1,3,0],rotation:[0,0,t()]}),Object(p.jsx)(P,{position:[1,1,0],rotation:[0,0,t()]}),Object(p.jsx)(C,{position:[1,3,0],rotation:[0,0,t()]}),Object(p.jsx)(f,{})]}))}function L(e){var t=function(){return(Math.floor(8*Math.random())-4)*Math.PI};return Object(p.jsxs)("group",Object(O.a)(Object(O.a)({name:"wall-with-clm"},e),{},{children:[Object(p.jsx)(P,{position:[-1,1,0],rotation:[0,0,t()]}),Object(p.jsx)(C,{position:[-1,3,0],rotation:[0,0,t()]}),Object(p.jsx)(P,{position:[1,1,0],rotation:[0,0,t()]}),Object(p.jsx)(C,{position:[1,3,0],rotation:[0,0,t()]}),Object(p.jsx)(w,{}),Object(p.jsx)(f,{})]}))}function q(e){var t=function(){return(Math.floor(8*Math.random())-4)*Math.PI};return Object(p.jsxs)("group",Object(O.a)(Object(O.a)({name:"wall-corner"},e),{},{children:[Object(p.jsx)(P,{position:[-1,1,0],rotation:[0,0,t()]}),Object(p.jsx)(C,{position:[-1,3,0],rotation:[0,0,t()]}),Object(p.jsx)(P,{position:[0,1,1],rotation:[0,Math.PI/2,t()]}),Object(p.jsx)(C,{position:[0,3,1],rotation:[0,Math.PI/2,t()]}),Object(p.jsx)(w,{}),Object(p.jsx)(f,{})]}))}function E(e){var t=function(){return(Math.floor(8*Math.random())-4)*Math.PI};return Object(p.jsxs)("group",Object(O.a)(Object(O.a)({name:"wall-T"},e),{},{children:[Object(p.jsx)(P,{position:[-1,1,0],rotation:[0,0,t()]}),Object(p.jsx)(C,{position:[-1,3,0],rotation:[0,0,t()]}),Object(p.jsx)(P,{position:[1,1,0],rotation:[0,0,t()]}),Object(p.jsx)(C,{position:[1,3,0],rotation:[0,0,t()]}),Object(p.jsx)(P,{position:[0,1,1],rotation:[0,Math.PI/2,t()]}),Object(p.jsx)(C,{position:[0,3,1],rotation:[0,Math.PI/2,t()]}),Object(p.jsx)(w,{}),Object(p.jsx)(f,{})]}))}function z(e){var t=function(){return(Math.floor(8*Math.random())-4)*Math.PI};return Object(p.jsxs)("group",Object(O.a)(Object(O.a)({name:"wall-X"},e),{},{children:[Object(p.jsx)(P,{position:[-1,1,0],rotation:[0,0,t()]}),Object(p.jsx)(C,{position:[-1,3,0],rotation:[0,0,t()]}),Object(p.jsx)(P,{position:[1,1,0],rotation:[0,0,t()]}),Object(p.jsx)(C,{position:[1,3,0],rotation:[0,0,t()]}),Object(p.jsx)(P,{position:[0,1,1],rotation:[0,Math.PI/2,t()]}),Object(p.jsx)(C,{position:[0,3,1],rotation:[0,Math.PI/2,t()]}),Object(p.jsx)(P,{position:[0,1,-1],rotation:[0,Math.PI/2,t()]}),Object(p.jsx)(C,{position:[0,3,-1],rotation:[0,Math.PI/2,t()]}),Object(p.jsx)(w,{}),Object(p.jsx)(f,{})]}))}h.a.preload(I),h.a.preload(S),h.a.preload(B);var _,Q="models/Statue_Horse.glb";function A(e){var t=Object(h.a)(Q).nodes;return t.Pedestal.position.set(0,0,0),t.Horse.position.x=0,t.Horse.position.z=0,Object(p.jsxs)("group",Object(O.a)(Object(O.a)({name:"statue-horse"},e),{},{children:[Object(p.jsx)("primitive",{object:t.Scene.clone(),castShadow:!0,receiveShadow:!0}),Object(p.jsx)(f,{})]}))}h.a.preload(Q),function(e){e[e.Void=0]="Void",e[e.Walkable=1]="Walkable",e[e.Blocked=2]="Blocked"}(_||(_={}));var R={version:0,size:64,tiles:[]},N=[{id:"qd2-floor",physics:[_.Walkable,_.Walkable,_.Walkable,_.Walkable,_.Walkable,_.Walkable,_.Walkable,_.Walkable,_.Walkable],element:Object(p.jsx)(f,{}),tags:["Quaternius","Dungeon","Floor"]},{id:"qd2-wall",physics:[_.Walkable,_.Walkable,_.Walkable,_.Blocked,_.Blocked,_.Blocked,_.Walkable,_.Walkable,_.Walkable],element:Object(p.jsx)(F,{}),tags:["Quaternius","Dungeon","Wall"]},{id:"qd2-wall-with-column",physics:[_.Walkable,_.Walkable,_.Walkable,_.Blocked,_.Blocked,_.Blocked,_.Walkable,_.Walkable,_.Walkable],element:Object(p.jsx)(L,{}),tags:["Quaternius","Dungeon","Wall with Column"]},{id:"qd2-wall-corner",physics:[_.Walkable,_.Blocked,_.Walkable,_.Walkable,_.Blocked,_.Blocked,_.Walkable,_.Walkable,_.Walkable],element:Object(p.jsx)(q,{}),tags:["Quaternius","Dungeon","Wall","Corner"]},{id:"qd2-wall-T",physics:[_.Walkable,_.Walkable,_.Walkable,_.Blocked,_.Blocked,_.Blocked,_.Walkable,_.Blocked,_.Walkable],element:Object(p.jsx)(E,{}),tags:["Quaternius","Dungeon","Wall T"]},{id:"qd2-wall-X",physics:[_.Walkable,_.Blocked,_.Walkable,_.Blocked,_.Blocked,_.Blocked,_.Walkable,_.Blocked,_.Walkable],element:Object(p.jsx)(z,{}),tags:["Quaternius","Dungeon","Wall X"]},{id:"qd2-wall-broken",physics:[_.Walkable,_.Walkable,_.Walkable,_.Walkable,_.Blocked,_.Walkable,_.Walkable,_.Walkable,_.Walkable],element:Object(p.jsx)(D,{}),tags:["Quaternius","Dungeon","Wall Broken"]},{id:"qd2-arch",physics:[_.Walkable,_.Walkable,_.Walkable,_.Blocked,_.Walkable,_.Blocked,_.Walkable,_.Walkable,_.Walkable],element:Object(p.jsx)(m,{}),tags:["Quaternius","Dungeon","Arch"]},{id:"qd2-square-column",physics:[_.Walkable,_.Walkable,_.Walkable,_.Walkable,_.Blocked,_.Walkable,_.Walkable,_.Walkable,_.Walkable],element:Object(p.jsx)(y,{}),tags:["Quaternius","Dungeon","Square Column"]},{id:"qd2-round-column",physics:[_.Walkable,_.Walkable,_.Walkable,_.Walkable,_.Blocked,_.Walkable,_.Walkable,_.Walkable,_.Walkable],element:Object(p.jsx)(M,{}),tags:["Quaternius","Dungeon","Round Column"]},{id:"qd2-statue-horse",physics:[_.Walkable,_.Walkable,_.Walkable,_.Walkable,_.Blocked,_.Walkable,_.Walkable,_.Walkable,_.Walkable],element:Object(p.jsx)(A,{}),tags:["Quaternius","Dungeon","Statue","Horse"]}];function H(){return N.length}function T(e){return N.find((function(t){return t.id===e}))}function J(e){if(!(e<0||e>=N.length))return N[e]}a(62);function V(){var e=Object(b.f)().camera;return console.log(e.position,e.rotation),Object(p.jsx)(p.Fragment,{})}function G(e){var t=e.tileIndex,a=Object(b.f)().gl;return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("directionalLight",{}),Object(p.jsx)("ambientLight",{}),Object(p.jsx)("group",{onClick:function(){var e=document.createElement("a");e.href=a.domElement.toDataURL().replace("image/png","image/octet-stream"),e.download="".concat(J(t).id,".png"),e.click()},"position-y":-1,children:J(t).element}),Object(p.jsx)(V,{}),Object(p.jsx)(j.a,{})]})}function K(){var e=n.a.useState(0),t=Object(s.a)(e,2),a=t[0],o=t[1];return d((function(e){var t="keyup"===e.type;switch(e.key.toLowerCase()){case"escape":o(0);break;case"[":t&&a>0&&o(a-1);break;case"]":t&&a<H()-1&&o(a+1)}})),Object(p.jsxs)("div",{className:"container",children:[Object(p.jsx)("h1",{children:"Admin page"}),Object(p.jsx)("h2",{children:"Create tile preview bitmap"}),Object(p.jsx)("div",{className:"icon-preview",children:Object(p.jsx)(b.a,{gl:{preserveDrawingBuffer:!0},camera:{position:[-1.3,3.4,4.4],quaternion:new u.Quaternion(-.65,-.24,-.18)},children:Object(p.jsx)(G,{tileIndex:a})})}),Object(p.jsx)("p",{children:"Click on tile to download image"})]})}var X=a(71);function U(e){var t=e.level,a=e.gridSize,o=t.tiles.map((function(e){var t;return Object(p.jsx)("group",{"position-x":e.x*a+a/2,"position-z":e.y*a+a/2,"rotation-y":-Math.PI/2*e.rotation,scale:[.25,.25,.25],children:null===(t=T(e.id))||void 0===t?void 0:t.element},"".concat(e.x,"x").concat(e.y))}));return Object(p.jsx)(p.Fragment,{children:o})}a(63);function Y(){var e=n.a.useRef(),t=n.a.useState(-1),a=Object(s.a)(t,2),r=a[0],c=a[1],i=n.a.useState(0),u=Object(s.a)(i,2),O=u[0],h=u[1],x=n.a.useState(R),f=Object(s.a)(x,2),k=f[0],m=f[1],v=Object(l.f)().level;n.a.useEffect((function(){fetch("levels/".concat(v||"default",".json")).then((function(e){return e.json()})).then((function(e){m(e)})).catch((function(e){console.log(e);var t=localStorage.getItem("untitled");t&&m(JSON.parse(t))}))}),[m,v]);d((function(e){var t="keyup"===e.type;switch(e.key.toLowerCase()){case"escape":c(-1);break;case"s":localStorage.setItem("untitled",JSON.stringify(k));break;case"r":t&&h((O+1)%4);break;case"[":t&&r>=0&&c(r-1);break;case"]":t&&r<H()-1&&c(r+1)}}));var g=1*k.size;return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("span",{className:"grid-pos"}),Object(p.jsx)(b.a,{shadowMap:!0,camera:{position:[8,5,0]},children:Object(p.jsxs)(o.Suspense,{fallback:null,children:[Object(p.jsx)(j.a,{maxPolarAngle:.5*Math.PI}),Object(p.jsx)(X.a,{}),Object(p.jsx)("directionalLight",{intensity:.4}),Object(p.jsx)("ambientLight",{intensity:.2}),Object(p.jsx)("gridHelper",{args:[g,k.size,2236962,4473924]}),Object(p.jsx)("axesHelper",{args:[g],"position-y":.01}),Object(p.jsx)(U,{gridSize:1,level:k}),Object(p.jsxs)("mesh",{name:"hidden-plane","rotation-x":-Math.PI/2,onPointerMove:function(t){var a=t.point;null===t||void 0===t||t.stopPropagation();var o=Math.floor(a.x/1),n=Math.floor(a.z/1);document.getElementsByClassName("grid-pos")[0].textContent="".concat(o,",").concat(n," / ").concat(a.x.toFixed(3),",").concat(a.z.toFixed(3)," / ").concat(O),e.current&&e.current.position.set(1*o+.5,0,1*n+.5)},onPointerDown:function(e){var t=e.point;null===e||void 0===e||e.stopPropagation();var a,o,n,i=Math.floor(t.x/1),l=Math.floor(t.z/1),s=(a=i,o=l,k.tiles.find((function(e){return e.x===a&&e.y===o})));if(e.shiftKey)return c(s?(n=s.id,N.findIndex((function(e){return e.id===n}))):-1),void(s&&h(s.rotation));var j=k.version,b=k.size,u=k.tiles.slice();s&&(-1!==r||e.ctrlKey)&&u.splice(u.indexOf(s),1),r>=0&&!e.ctrlKey&&u.push({id:J(r).id,x:i,y:l,rotation:O}),m({version:j,size:b,tiles:u})},children:[Object(p.jsx)("planeBufferGeometry",{args:[g,g]}),Object(p.jsx)("meshBasicMaterial",{visible:!1})]}),Object(p.jsxs)("group",{ref:e,name:"cursor-container",position:[.5,0,.5],children:[r>=0&&Object(p.jsx)("group",{scale:[.25,.25,.25],"rotation-y":-Math.PI/2*O,name:"tile-container",children:J(r).element}),Object(p.jsxs)("mesh",{name:"cursor","rotation-x":-Math.PI/2,"position-y":.01,children:[Object(p.jsx)("planeBufferGeometry",{args:[1,1,3,3]}),Object(p.jsx)("meshBasicMaterial",{color:4456448,wireframe:!0})]})]})]})})]})}function Z(){return Object(p.jsx)("div",{children:Object(p.jsxs)("ul",{children:[Object(p.jsx)("li",{children:Object(p.jsx)(i.b,{to:"/",children:"Home"})}),Object(p.jsx)("li",{children:Object(p.jsx)(i.b,{to:"/play",children:"Play"})}),Object(p.jsx)("li",{children:Object(p.jsx)(i.b,{to:"/edit",children:"Edit"})})]})})}var $=a(72),ee=a(73),te=n.a.forwardRef((function(e,t){var a=e.animation,o=void 0===a?"Idle":a,r=e.character,c=void 0===r?"Warrior":r,i=Object(v.a)(e,["animation","character"]),l=Object(h.a)("npc/".concat(c,".glb")),j=l.animations,b=l.nodes,d=Object($.a)(j),x=d.ref,f=d.actions,k=Object(ee.a)("npc/".concat(c,"_Texture.png"));k.wrapS=k.wrapT=u.RepeatWrapping;var m=n.a.useState(""),g=Object(s.a)(m,2),W=g[0],w=g[1];return b.Scene.traverse((function(e){if(e instanceof u.Mesh){var t=e;(Array.isArray(t.material)?t.material:[t.material]).forEach((function(e){e.map=k}))}})),n.a.useEffect((function(){o&&W!==o&&(W&&f[W].stop(),w(o),f[o].play())}),[f,W,w,o]),Object(p.jsxs)("group",Object(O.a)(Object(O.a)({name:"player"},i),{},{ref:t,children:[Object(p.jsx)("primitive",{ref:x,object:b.Scene}),i.children]}))}));a(69);function ae(e){var t=e.level,a=n.a.useRef(),o=n.a.useRef(),r=n.a.useRef(new u.Vector3),c=n.a.useRef(),i=n.a.useState("Idle"),l=Object(s.a)(i,2),j=l[0],O=l[1],h=192,x=n.a.useMemo((function(){var e=new Array(36864).fill(_.Void);return t.tiles.forEach((function(t){var a=3*(t.x+32),o=3*(t.y+32),n=T(t.id);if(n){for(var r=n.physics.slice(),c=0;c<t.rotation;c++){var i=r.slice();r[0]=i[6],r[1]=i[3],r[2]=i[0],r[3]=i[7],r[4]=i[4],r[5]=i[1],r[6]=i[8],r[7]=i[5],r[8]=i[2]}for(var l=o*h+a,s=0;s<3;s++)e[l+0]=r[3*s+0],e[l+1]=r[3*s+1],e[l+2]=r[3*s+2],l+=h}})),e}),[t.tiles,h]),f=(n.a.useMemo((function(){var e=[];return x.forEach((function(t,a){if(t===_.Blocked){var o=a%h*1/3-32+1/3/2,n=1*Math.floor(a/h)/3-32+1/3/2;e.push(Object(p.jsxs)("mesh",{position:[o,1,n],children:[Object(p.jsx)("boxBufferGeometry",{args:[1/3,2,1/3]}),Object(p.jsx)("meshLambertMaterial",{color:"hotpink"})]},a))}})),e}),[h,x]),{left:!1,right:!1,forward:!1,backward:!1,attack:!1});Object(b.d)((function(e){var t=e.camera;if(o.current&&c.current){c.current.getWorldPosition(r.current),t.position.lerp(r.current,.05);var a=o.current.position;if(t.lookAt(a.x,a.y+.5,a.z),f.left&&(o.current.rotation.y+=.005*Math.PI),f.right&&(o.current.rotation.y+=.005*-Math.PI),f.forward||f.backward){r.current.set(0,0,f.forward?.01:-.01),r.current.applyQuaternion(o.current.quaternion),r.current.add(o.current.position);var n=Math.floor((r.current.x+32)/(1/3)),i=Math.floor((r.current.z+32)/(1/3));x[i*h+n]===_.Walkable&&o.current.position.copy(r.current)}}})),d((function(e){var t="keydown"===e.type,a=.1;switch(e.key.toLowerCase()){case"arrowup":c.current&&(c.current.position.y-=a);break;case"arrowdown":c.current&&(c.current.position.y+=a);break;case"arrowleft":c.current&&(c.current.position.x-=a);break;case"arrowright":c.current&&(c.current.position.x+=a);break;case"1":c.current&&c.current.position.set(.7,13,-2);break;case"2":c.current&&c.current.position.set(.7,3,-2);break;case"w":f.forward=t,O(t?"Walk":"Idle");break;case"a":f.left=t;break;case"s":f.backward=t,O(t?"Walk":"Idle");break;case"d":f.right=t;break;case"c":break;case"space":case" ":f.attack=t;break;default:console.log(e.key)}}));var k=n.a.useMemo((function(){return Object(p.jsx)(U,{level:t,gridSize:1})}),[t]);return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(X.a,{}),Object(p.jsx)("ambientLight",{intensity:.2}),Object(p.jsx)("directionalLight",{intensity:.4,position:[2.5,1,.4],ref:a,castShadow:!0}),k,Object(p.jsx)(te,{animation:j,scale:[.2,.2,.2],position:[1.5,.06,.4],ref:o,children:Object(p.jsx)("group",{position:[.7,3,-2],ref:c})})]})}function oe(){var e=n.a.useState(R),t=Object(s.a)(e,2),a=t[0],r=t[1],c=Object(l.f)().level;return n.a.useEffect((function(){fetch("levels/".concat(c||"default",".json")).then((function(e){return e.json()})).then((function(e){r(e)})).catch((function(e){console.log(e);var t=localStorage.getItem("untitled");t&&r(JSON.parse(t))}))}),[r,c]),Object(p.jsx)(b.a,{shadowMap:!0,camera:{position:[8,5,0]},className:"ingame",children:Object(p.jsx)(o.Suspense,{fallback:null,children:Object(p.jsx)(ae,{level:a})})})}function ne(){return Object(p.jsx)(i.a,{children:Object(p.jsxs)(l.c,{children:[Object(p.jsx)(l.a,{exact:!0,path:"/",children:Object(p.jsx)(Z,{})}),Object(p.jsx)(l.a,{path:"/play/:level?",children:Object(p.jsx)(oe,{})}),Object(p.jsx)(l.a,{path:"/edit/:level?",children:Object(p.jsx)(Y,{})}),Object(p.jsx)(l.a,{path:"/admin",children:Object(p.jsx)(K,{})})]})})}var re=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,76)).then((function(t){var a=t.getCLS,o=t.getFID,n=t.getFCP,r=t.getLCP,c=t.getTTFB;a(e),o(e),n(e),r(e),c(e)}))};c.a.render(Object(p.jsx)(n.a.StrictMode,{children:Object(p.jsx)(ne,{})}),document.getElementById("root")),re()}},[[70,1,2]]]);
//# sourceMappingURL=main.94570de5.chunk.js.map