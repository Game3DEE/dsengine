(this.webpackJsonpdsengine=this.webpackJsonpdsengine||[]).push([[0],{56:function(e,t,a){},62:function(e,t,a){},63:function(e,t,a){},69:function(e,t,a){},70:function(e,t,a){"use strict";a.r(t);var o=a(2),n=a.n(o),r=a(46),c=a.n(r),i=(a(56),a(26)),l=a(14),s=a(11),j=a(75),b=a(13),u=a(0),d=function(e){n.a.useEffect((function(){return document.addEventListener("keydown",e,!1),document.addEventListener("keyup",e,!1),function(){document.removeEventListener("keydown",e),document.removeEventListener("keyup",e)}}))},O=a(9),p=a(74),h=a(1),x="models/Floor_Modular.glb";function k(e){var t=Object(p.a)(x).nodes,a=function(){return(Math.floor(8*Math.random())-4)*Math.PI};return Object(h.jsxs)("group",Object(O.a)(Object(O.a)({name:"floor"},e),{},{children:[Object(h.jsx)("primitive",{object:t.Floor_Modular.clone(),position:[-1,-.08,-1],"rotation-y":a(),receiveShadow:!0}),Object(h.jsx)("primitive",{object:t.Floor_Modular.clone(),position:[1,-.08,-1],"rotation-y":a(),receiveShadow:!0}),Object(h.jsx)("primitive",{object:t.Floor_Modular.clone(),position:[-1,-.08,1],"rotation-y":a(),receiveShadow:!0}),Object(h.jsx)("primitive",{object:t.Floor_Modular.clone(),position:[1,-.08,1],"rotation-y":a(),receiveShaodw:!0})]}))}p.a.preload(x);var f="models/Arch.glb";function m(e){var t=Object(p.a)(f).nodes;return Object(h.jsxs)("group",Object(O.a)(Object(O.a)({name:"arch"},e),{},{children:[Object(h.jsx)("primitive",{object:t.Arch.clone(),castShadow:!0,receiveShadow:!0}),Object(h.jsx)(k,{})]}))}p.a.preload(f);var v=a(15),g="models/Column.glb",W="models/Column2.glb";function w(e){var t=Object(p.a)(g).nodes;return Object(h.jsx)("primitive",Object(O.a)({object:t.Column.clone(),castShadow:!0,receiveShadow:!0},e))}function y(e){return Object(h.jsxs)("group",Object(O.a)(Object(O.a)({name:"sqcolumn"},e),{},{children:[Object(h.jsx)(w,{}),Object(h.jsx)(k,{})]}))}function M(e){var t=Object(p.a)(W).nodes;return Object(h.jsxs)("group",Object(O.a)(Object(O.a)({name:"rncolumn"},e),{},{children:[Object(h.jsx)("primitive",{object:t.Column2.clone(),castShadow:!0,receiveShadow:!0}),Object(h.jsx)(k,{})]}))}p.a.preload(g),p.a.preload(W);var S="models/Wall_Modular.glb",B="models/WallCover_Modular.glb",I="models/Decorative_Wall.glb";function P(e){var t=e.rotation,a=Object(v.a)(e,["rotation"]),o=Object(p.a)(B).nodes,n=Object(p.a)(S).nodes,r=void 0;if(t){var c=t;r=[c[0],c[1],0]}return Object(h.jsxs)("group",Object(O.a)(Object(O.a)({},a),{},{children:[Object(h.jsx)("primitive",{object:o.WallCover_Modular.clone(),rotation:r,castShadow:!0,receiveShadow:!0}),Object(h.jsx)("primitive",{object:n.Wall_Modular.clone(),rotation:t,castShadow:!0,receiveShadow:!0})]}))}function C(e){var t=Object(p.a)(S).nodes;return Object(h.jsx)("primitive",Object(O.a)({object:t.Wall_Modular.clone(),castShadow:!0,receiveShadow:!0},e))}function D(e){var t=Object(p.a)(I).nodes;return Object(h.jsxs)("group",Object(O.a)(Object(O.a)({name:"wall-broken"},e),{},{children:[Object(h.jsx)("primitive",{object:t.Decorative_Wall.clone(),"position-y":1}),Object(h.jsx)(k,{})]}))}function F(e){var t=function(){return(Math.floor(8*Math.random())-4)*Math.PI};return Object(h.jsxs)("group",Object(O.a)(Object(O.a)({name:"wall"},e),{},{children:[Object(h.jsx)(P,{position:[-1,1,0],rotation:[0,0,t()]}),Object(h.jsx)(C,{position:[-1,3,0],rotation:[0,0,t()]}),Object(h.jsx)(P,{position:[1,1,0],rotation:[0,0,t()]}),Object(h.jsx)(C,{position:[1,3,0],rotation:[0,0,t()]}),Object(h.jsx)(k,{})]}))}function L(e){var t=function(){return(Math.floor(8*Math.random())-4)*Math.PI};return Object(h.jsxs)("group",Object(O.a)(Object(O.a)({name:"wall-with-clm"},e),{},{children:[Object(h.jsx)(P,{position:[-1,1,0],rotation:[0,0,t()]}),Object(h.jsx)(C,{position:[-1,3,0],rotation:[0,0,t()]}),Object(h.jsx)(P,{position:[1,1,0],rotation:[0,0,t()]}),Object(h.jsx)(C,{position:[1,3,0],rotation:[0,0,t()]}),Object(h.jsx)(w,{}),Object(h.jsx)(k,{})]}))}function q(e){var t=function(){return(Math.floor(8*Math.random())-4)*Math.PI};return Object(h.jsxs)("group",Object(O.a)(Object(O.a)({name:"wall-corner"},e),{},{children:[Object(h.jsx)(P,{position:[-1,1,0],rotation:[0,0,t()]}),Object(h.jsx)(C,{position:[-1,3,0],rotation:[0,0,t()]}),Object(h.jsx)(P,{position:[0,1,1],rotation:[0,Math.PI/2,t()]}),Object(h.jsx)(C,{position:[0,3,1],rotation:[0,Math.PI/2,t()]}),Object(h.jsx)(w,{}),Object(h.jsx)(k,{})]}))}function z(e){var t=function(){return(Math.floor(8*Math.random())-4)*Math.PI};return Object(h.jsxs)("group",Object(O.a)(Object(O.a)({name:"wall-T"},e),{},{children:[Object(h.jsx)(P,{position:[-1,1,0],rotation:[0,0,t()]}),Object(h.jsx)(C,{position:[-1,3,0],rotation:[0,0,t()]}),Object(h.jsx)(P,{position:[1,1,0],rotation:[0,0,t()]}),Object(h.jsx)(C,{position:[1,3,0],rotation:[0,0,t()]}),Object(h.jsx)(P,{position:[0,1,1],rotation:[0,Math.PI/2,t()]}),Object(h.jsx)(C,{position:[0,3,1],rotation:[0,Math.PI/2,t()]}),Object(h.jsx)(w,{}),Object(h.jsx)(k,{})]}))}function E(e){var t=function(){return(Math.floor(8*Math.random())-4)*Math.PI};return Object(h.jsxs)("group",Object(O.a)(Object(O.a)({name:"wall-X"},e),{},{children:[Object(h.jsx)(P,{position:[-1,1,0],rotation:[0,0,t()]}),Object(h.jsx)(C,{position:[-1,3,0],rotation:[0,0,t()]}),Object(h.jsx)(P,{position:[1,1,0],rotation:[0,0,t()]}),Object(h.jsx)(C,{position:[1,3,0],rotation:[0,0,t()]}),Object(h.jsx)(P,{position:[0,1,1],rotation:[0,Math.PI/2,t()]}),Object(h.jsx)(C,{position:[0,3,1],rotation:[0,Math.PI/2,t()]}),Object(h.jsx)(P,{position:[0,1,-1],rotation:[0,Math.PI/2,t()]}),Object(h.jsx)(C,{position:[0,3,-1],rotation:[0,Math.PI/2,t()]}),Object(h.jsx)(w,{}),Object(h.jsx)(k,{})]}))}p.a.preload(I),p.a.preload(S),p.a.preload(B);var _,Q="models/Statue_Horse.glb";function A(e){var t=Object(p.a)(Q).nodes;return t.Pedestal.position.set(0,0,0),t.Horse.position.x=0,t.Horse.position.z=0,Object(h.jsxs)("group",Object(O.a)(Object(O.a)({name:"statue-horse"},e),{},{children:[Object(h.jsx)("primitive",{object:t.Scene.clone(),castShadow:!0,receiveShadow:!0}),Object(h.jsx)(k,{})]}))}p.a.preload(Q),function(e){e[e.Void=0]="Void",e[e.Walkable=1]="Walkable",e[e.Blocked=2]="Blocked"}(_||(_={}));var R=[{id:"qd2-floor",physics:[_.Walkable,_.Walkable,_.Walkable,_.Walkable,_.Walkable,_.Walkable,_.Walkable,_.Walkable,_.Walkable],element:Object(h.jsx)(k,{}),tags:["Quaternius","Dungeon","Floor"]},{id:"qd2-wall",physics:[_.Walkable,_.Walkable,_.Walkable,_.Blocked,_.Blocked,_.Blocked,_.Walkable,_.Walkable,_.Walkable],element:Object(h.jsx)(F,{}),tags:["Quaternius","Dungeon","Wall"]},{id:"qd2-wall-with-column",physics:[_.Walkable,_.Walkable,_.Walkable,_.Blocked,_.Blocked,_.Blocked,_.Walkable,_.Walkable,_.Walkable],element:Object(h.jsx)(L,{}),tags:["Quaternius","Dungeon","Wall with Column"]},{id:"qd2-wall-corner",physics:[_.Walkable,_.Blocked,_.Walkable,_.Walkable,_.Blocked,_.Blocked,_.Walkable,_.Walkable,_.Walkable],element:Object(h.jsx)(q,{}),tags:["Quaternius","Dungeon","Wall","Corner"]},{id:"qd2-wall-T",physics:[_.Walkable,_.Walkable,_.Walkable,_.Blocked,_.Blocked,_.Blocked,_.Walkable,_.Blocked,_.Walkable],element:Object(h.jsx)(z,{}),tags:["Quaternius","Dungeon","Wall T"]},{id:"qd2-wall-X",physics:[_.Walkable,_.Blocked,_.Walkable,_.Blocked,_.Blocked,_.Blocked,_.Walkable,_.Blocked,_.Walkable],element:Object(h.jsx)(E,{}),tags:["Quaternius","Dungeon","Wall X"]},{id:"qd2-wall-broken",physics:[_.Walkable,_.Walkable,_.Walkable,_.Walkable,_.Blocked,_.Walkable,_.Walkable,_.Walkable,_.Walkable],element:Object(h.jsx)(D,{}),tags:["Quaternius","Dungeon","Wall Broken"]},{id:"qd2-arch",physics:[_.Walkable,_.Walkable,_.Walkable,_.Blocked,_.Walkable,_.Blocked,_.Walkable,_.Walkable,_.Walkable],element:Object(h.jsx)(m,{}),tags:["Quaternius","Dungeon","Arch"]},{id:"qd2-square-column",physics:[_.Walkable,_.Walkable,_.Walkable,_.Walkable,_.Blocked,_.Walkable,_.Walkable,_.Walkable,_.Walkable],element:Object(h.jsx)(y,{}),tags:["Quaternius","Dungeon","Square Column"]},{id:"qd2-round-column",physics:[_.Walkable,_.Walkable,_.Walkable,_.Walkable,_.Blocked,_.Walkable,_.Walkable,_.Walkable,_.Walkable],element:Object(h.jsx)(M,{}),tags:["Quaternius","Dungeon","Round Column"]},{id:"qd2-statue-horse",physics:[_.Walkable,_.Walkable,_.Walkable,_.Walkable,_.Blocked,_.Walkable,_.Walkable,_.Walkable,_.Walkable],element:Object(h.jsx)(A,{}),tags:["Quaternius","Dungeon","Statue","Horse"]}];function N(){return R.length}function H(e){return R.find((function(t){return t.id===e}))}function T(e){if(!(e<0||e>=R.length))return R[e]}a(62);function J(){var e=Object(b.f)().camera;return console.log(e.position,e.rotation),Object(h.jsx)(h.Fragment,{})}function V(e){var t=e.tileIndex,a=Object(b.f)().gl;return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)("directionalLight",{}),Object(h.jsx)("ambientLight",{}),Object(h.jsx)("group",{onClick:function(){var e=document.createElement("a");e.href=a.domElement.toDataURL().replace("image/png","image/octet-stream"),e.download="".concat(T(t).id,".png"),e.click()},"position-y":-1,children:T(t).element}),Object(h.jsx)(J,{}),Object(h.jsx)(j.a,{})]})}function G(){var e=n.a.useState(0),t=Object(s.a)(e,2),a=t[0],o=t[1];return d((function(e){var t="keyup"===e.type;switch(e.key.toLowerCase()){case"escape":o(0);break;case"[":t&&a>0&&o(a-1);break;case"]":t&&a<N()-1&&o(a+1)}})),Object(h.jsxs)("div",{className:"container",children:[Object(h.jsx)("h1",{children:"Admin page"}),Object(h.jsx)("h2",{children:"Create tile preview bitmap"}),Object(h.jsx)("div",{className:"icon-preview",children:Object(h.jsx)(b.a,{gl:{preserveDrawingBuffer:!0},camera:{position:[-1.3,3.4,4.4],quaternion:new u.Quaternion(-.65,-.24,-.18)},children:Object(h.jsx)(V,{tileIndex:a})})}),Object(h.jsx)("p",{children:"Click on tile to download image"})]})}var K=a(71);function X(e){var t=e.level,a=e.gridSize,o=t.tiles.map((function(e){var t;return Object(h.jsx)("group",{"position-x":e.x*a+a/2,"position-z":e.y*a+a/2,"rotation-y":-Math.PI/2*e.rotation,scale:[.25,.25,.25],children:null===(t=H(e.id))||void 0===t?void 0:t.element},"".concat(e.x,"x").concat(e.y))}));return Object(h.jsx)(h.Fragment,{children:o})}a(63);var U={version:0,size:64,tiles:[]};function Y(){var e=n.a.useRef(),t=n.a.useState(-1),a=Object(s.a)(t,2),r=a[0],c=a[1],i=n.a.useState(0),l=Object(s.a)(i,2),u=l[0],O=l[1],p=n.a.useState(U),x=Object(s.a)(p,2),k=x[0],f=x[1];n.a.useEffect((function(){var e=localStorage.getItem("untitled");if(e){var t=JSON.parse(e);f(t)}}),[f]);d((function(e){var t="keyup"===e.type;switch(e.key.toLowerCase()){case"escape":c(-1);break;case"s":localStorage.setItem("untitled",JSON.stringify(k));break;case"r":t&&O((u+1)%4);break;case"[":t&&r>=0&&c(r-1);break;case"]":t&&r<N()-1&&c(r+1)}}));var m=1*k.size;return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)("span",{className:"grid-pos"}),Object(h.jsx)(b.a,{shadowMap:!0,camera:{position:[8,5,0]},children:Object(h.jsxs)(o.Suspense,{fallback:null,children:[Object(h.jsx)(j.a,{maxPolarAngle:.5*Math.PI}),Object(h.jsx)(K.a,{}),Object(h.jsx)("directionalLight",{intensity:.4}),Object(h.jsx)("ambientLight",{intensity:.2}),Object(h.jsx)("gridHelper",{args:[m,k.size,2236962,4473924]}),Object(h.jsx)("axesHelper",{args:[m],"position-y":.01}),Object(h.jsx)(X,{gridSize:1,level:k}),Object(h.jsxs)("mesh",{name:"hidden-plane","rotation-x":-Math.PI/2,onPointerMove:function(t){var a=t.point;null===t||void 0===t||t.stopPropagation();var o=Math.floor(a.x/1),n=Math.floor(a.z/1);document.getElementsByClassName("grid-pos")[0].textContent="".concat(o,",").concat(n," / ").concat(a.x.toFixed(3),",").concat(a.z.toFixed(3)," / ").concat(u),e.current&&e.current.position.set(1*o+.5,0,1*n+.5)},onPointerDown:function(e){var t=e.point;null===e||void 0===e||e.stopPropagation();var a,o,n,i=Math.floor(t.x/1),l=Math.floor(t.z/1),s=(a=i,o=l,k.tiles.find((function(e){return e.x===a&&e.y===o})));if(e.shiftKey)return c(s?(n=s.id,R.findIndex((function(e){return e.id===n}))):-1),void(s&&O(s.rotation));var j=k.version,b=k.size,d=k.tiles.slice();s&&(-1!==r||e.ctrlKey)&&d.splice(d.indexOf(s),1),r>=0&&!e.ctrlKey&&d.push({id:T(r).id,x:i,y:l,rotation:u}),f({version:j,size:b,tiles:d})},children:[Object(h.jsx)("planeBufferGeometry",{args:[m,m]}),Object(h.jsx)("meshBasicMaterial",{visible:!1})]}),Object(h.jsxs)("group",{ref:e,name:"cursor-container",position:[.5,0,.5],children:[r>=0&&Object(h.jsx)("group",{scale:[.25,.25,.25],"rotation-y":-Math.PI/2*u,name:"tile-container",children:T(r).element}),Object(h.jsxs)("mesh",{name:"cursor","rotation-x":-Math.PI/2,"position-y":.01,children:[Object(h.jsx)("planeBufferGeometry",{args:[1,1,3,3]}),Object(h.jsx)("meshBasicMaterial",{color:4456448,wireframe:!0})]})]})]})})]})}function Z(){return Object(h.jsx)("div",{children:Object(h.jsxs)("ul",{children:[Object(h.jsx)("li",{children:Object(h.jsx)(i.b,{to:"/",children:"Home"})}),Object(h.jsx)("li",{children:Object(h.jsx)(i.b,{to:"/play",children:"Play"})}),Object(h.jsx)("li",{children:Object(h.jsx)(i.b,{to:"/edit",children:"Edit"})})]})})}var $=a(72),ee=a(73),te=n.a.forwardRef((function(e,t){var a=e.animation,o=void 0===a?"Idle":a,r=e.character,c=void 0===r?"Warrior":r,i=Object(v.a)(e,["animation","character"]),l=Object(p.a)("npc/".concat(c,".glb")),j=l.animations,b=l.nodes,d=Object($.a)(j),x=d.ref,k=d.actions,f=Object(ee.a)("npc/".concat(c,"_Texture.png"));f.wrapS=f.wrapT=u.RepeatWrapping;var m=n.a.useState(""),g=Object(s.a)(m,2),W=g[0],w=g[1];return b.Scene.traverse((function(e){if(e instanceof u.Mesh){var t=e;(Array.isArray(t.material)?t.material:[t.material]).forEach((function(e){e.map=f}))}})),n.a.useEffect((function(){o&&W!==o&&(W&&k[W].stop(),w(o),k[o].play())}),[k,W,w,o]),Object(h.jsxs)("group",Object(O.a)(Object(O.a)({name:"player"},i),{},{ref:t,children:[Object(h.jsx)("primitive",{ref:x,object:b.Scene}),i.children]}))}));a(69);function ae(e){var t=e.level,a=n.a.useRef(),o=n.a.useRef(),r=n.a.useRef(new u.Vector3),c=n.a.useRef(),i=n.a.useState("Idle"),l=Object(s.a)(i,2),j=l[0],O=l[1],p=192,x=n.a.useMemo((function(){var e=new Array(36864).fill(_.Void);return t.tiles.forEach((function(t){var a=3*(t.x+32),o=3*(t.y+32),n=H(t.id);if(n){for(var r=n.physics.slice(),c=0;c<t.rotation;c++){var i=r.slice();r[0]=i[6],r[1]=i[3],r[2]=i[0],r[3]=i[7],r[4]=i[4],r[5]=i[1],r[6]=i[8],r[7]=i[5],r[8]=i[2]}for(var l=o*p+a,s=0;s<3;s++)e[l+0]=r[3*s+0],e[l+1]=r[3*s+1],e[l+2]=r[3*s+2],l+=p}})),e}),[t.tiles,p]),k=(n.a.useMemo((function(){var e=[];return x.forEach((function(t,a){if(t===_.Blocked){var o=a%p*1/3-32+1/3/2,n=1*Math.floor(a/p)/3-32+1/3/2;e.push(Object(h.jsxs)("mesh",{position:[o,1,n],children:[Object(h.jsx)("boxBufferGeometry",{args:[1/3,2,1/3]}),Object(h.jsx)("meshLambertMaterial",{color:"hotpink"})]},a))}})),e}),[p,x]),{left:!1,right:!1,forward:!1,backward:!1,attack:!1});Object(b.d)((function(e){var t=e.camera;if(o.current&&c.current){c.current.getWorldPosition(r.current),t.position.lerp(r.current,.05);var a=o.current.position;if(t.lookAt(a.x,a.y+.5,a.z),k.left&&(o.current.rotation.y+=.005*Math.PI),k.right&&(o.current.rotation.y+=.005*-Math.PI),k.forward||k.backward){r.current.set(0,0,k.forward?.01:-.01),r.current.applyQuaternion(o.current.quaternion),r.current.add(o.current.position);var n=Math.floor((r.current.x+32)/(1/3)),i=Math.floor((r.current.z+32)/(1/3));x[i*p+n]===_.Walkable&&o.current.position.copy(r.current)}}})),d((function(e){var t="keydown"===e.type,a=.1;switch(e.key.toLowerCase()){case"arrowup":c.current&&(c.current.position.y-=a);break;case"arrowdown":c.current&&(c.current.position.y+=a);break;case"arrowleft":c.current&&(c.current.position.x-=a);break;case"arrowright":c.current&&(c.current.position.x+=a);break;case"w":k.forward=t,O(t?"Walk":"Idle");break;case"a":k.left=t;break;case"s":k.backward=t,O(t?"Walk":"Idle");break;case"d":k.right=t;break;case"c":break;case"space":case" ":k.attack=t;break;default:console.log(e.key)}}));var f=n.a.useMemo((function(){return Object(h.jsx)(X,{level:t,gridSize:1})}),[t]);return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(K.a,{}),Object(h.jsx)("ambientLight",{intensity:.2}),Object(h.jsx)("directionalLight",{intensity:.4,position:[2.5,1,.4],ref:a,castShadow:!0}),f,Object(h.jsx)(te,{animation:j,scale:[.2,.2,.2],position:[1.5,.06,.4],ref:o,children:Object(h.jsx)("group",{position:[.7,13,-2],ref:c})})]})}function oe(){var e=JSON.parse(localStorage.getItem("untitled"));return Object(h.jsx)(b.a,{shadowMap:!0,camera:{position:[8,5,0]},className:"ingame",children:Object(h.jsx)(o.Suspense,{fallback:null,children:Object(h.jsx)(ae,{level:e})})})}function ne(){return Object(h.jsx)(i.a,{children:Object(h.jsxs)(l.c,{children:[Object(h.jsx)(l.a,{exact:!0,path:"/",children:Object(h.jsx)(Z,{})}),Object(h.jsx)(l.a,{path:"/play",children:Object(h.jsx)(oe,{})}),Object(h.jsx)(l.a,{path:"/edit",children:Object(h.jsx)(Y,{})}),Object(h.jsx)(l.a,{path:"/admin",children:Object(h.jsx)(G,{})})]})})}var re=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,76)).then((function(t){var a=t.getCLS,o=t.getFID,n=t.getFCP,r=t.getLCP,c=t.getTTFB;a(e),o(e),n(e),r(e),c(e)}))};c.a.render(Object(h.jsx)(n.a.StrictMode,{children:Object(h.jsx)(ne,{})}),document.getElementById("root")),re()}},[[70,1,2]]]);
//# sourceMappingURL=main.01a2f5bc.chunk.js.map