(this.webpackJsonpdsengine=this.webpackJsonpdsengine||[]).push([[0],{57:function(e,t,a){},63:function(e,t,a){},64:function(e,t,a){},70:function(e,t,a){},71:function(e,t,a){},72:function(e,t,a){"use strict";a.r(t);var o=a(2),n=a.n(o),c=a(46),r=a.n(c),i=(a(57),a(21)),l=a(13),s=a(10),j=a(77),b=a(14),d=a(1),u=function(e){n.a.useEffect((function(){return document.addEventListener("keydown",e,!1),document.addEventListener("keyup",e,!1),function(){document.removeEventListener("keydown",e),document.removeEventListener("keyup",e)}}))},h=a(9),O=a(76),p=a(0),x="models/Floor_Modular.glb";function f(e){var t=Object(O.a)(x).nodes,a=function(){return(Math.floor(8*Math.random())-4)*Math.PI};return Object(p.jsxs)("group",Object(h.a)(Object(h.a)({name:"floor"},e),{},{children:[Object(p.jsx)("primitive",{object:t.Floor_Modular.clone(),position:[-1,-.08,-1],"rotation-y":a(),receiveShadow:!0}),Object(p.jsx)("primitive",{object:t.Floor_Modular.clone(),position:[1,-.08,-1],"rotation-y":a(),receiveShadow:!0}),Object(p.jsx)("primitive",{object:t.Floor_Modular.clone(),position:[-1,-.08,1],"rotation-y":a(),receiveShadow:!0}),Object(p.jsx)("primitive",{object:t.Floor_Modular.clone(),position:[1,-.08,1],"rotation-y":a(),receiveShaodw:!0})]}))}O.a.preload(x);var m="models/Arch.glb";function k(e){var t=Object(O.a)(m).nodes;return Object(p.jsxs)("group",Object(h.a)(Object(h.a)({name:"arch"},e),{},{children:[Object(p.jsx)("primitive",{object:t.Arch.clone(),castShadow:!0,receiveShadow:!0}),Object(p.jsx)(f,{})]}))}O.a.preload(m);var v=a(15),g="models/Column.glb",w="models/Column2.glb";function W(e){var t=Object(O.a)(g).nodes;return Object(p.jsx)("primitive",Object(h.a)({object:t.Column.clone(),castShadow:!0,receiveShadow:!0},e))}function y(e){return Object(p.jsxs)("group",Object(h.a)(Object(h.a)({name:"sqcolumn"},e),{},{children:[Object(p.jsx)(W,{}),Object(p.jsx)(f,{})]}))}function M(e){var t=Object(O.a)(w).nodes;return Object(p.jsxs)("group",Object(h.a)(Object(h.a)({name:"rncolumn"},e),{},{children:[Object(p.jsx)("primitive",{object:t.Column2.clone(),castShadow:!0,receiveShadow:!0}),Object(p.jsx)(f,{})]}))}O.a.preload(g),O.a.preload(w);var S="models/Wall_Modular.glb",B="models/WallCover_Modular.glb",I="models/Decorative_Wall.glb";function P(e){var t=e.rotation,a=Object(v.a)(e,["rotation"]),o=Object(O.a)(B).nodes,n=Object(O.a)(S).nodes,c=void 0;if(t){var r=t;c=[r[0],r[1],0]}return Object(p.jsxs)("group",Object(h.a)(Object(h.a)({},a),{},{children:[Object(p.jsx)("primitive",{object:o.WallCover_Modular.clone(),rotation:c,castShadow:!0,receiveShadow:!0}),Object(p.jsx)("primitive",{object:n.Wall_Modular.clone(),rotation:t,castShadow:!0,receiveShadow:!0})]}))}function q(e){var t=Object(O.a)(S).nodes;return Object(p.jsx)("primitive",Object(h.a)({object:t.Wall_Modular.clone(),castShadow:!0,receiveShadow:!0},e))}function D(e){var t=Object(O.a)(I).nodes;return Object(p.jsxs)("group",Object(h.a)(Object(h.a)({name:"wall-broken"},e),{},{children:[Object(p.jsx)("primitive",{object:t.Decorative_Wall.clone(),"position-y":1}),Object(p.jsx)(f,{})]}))}function C(e){var t=function(){return(Math.floor(8*Math.random())-4)*Math.PI};return Object(p.jsxs)("group",Object(h.a)(Object(h.a)({name:"wall"},e),{},{children:[Object(p.jsx)(P,{position:[-1,1,0],rotation:[0,0,t()]}),Object(p.jsx)(q,{position:[-1,3,0],rotation:[0,0,t()]}),Object(p.jsx)(P,{position:[1,1,0],rotation:[0,0,t()]}),Object(p.jsx)(q,{position:[1,3,0],rotation:[0,0,t()]}),Object(p.jsx)(f,{})]}))}function R(e){var t=function(){return(Math.floor(8*Math.random())-4)*Math.PI};return Object(p.jsxs)("group",Object(h.a)(Object(h.a)({name:"wall-with-clm"},e),{},{children:[Object(p.jsx)(P,{position:[-1,1,0],rotation:[0,0,t()]}),Object(p.jsx)(q,{position:[-1,3,0],rotation:[0,0,t()]}),Object(p.jsx)(P,{position:[1,1,0],rotation:[0,0,t()]}),Object(p.jsx)(q,{position:[1,3,0],rotation:[0,0,t()]}),Object(p.jsx)(W,{}),Object(p.jsx)(f,{})]}))}function E(e){var t=function(){return(Math.floor(8*Math.random())-4)*Math.PI};return Object(p.jsxs)("group",Object(h.a)(Object(h.a)({name:"wall-corner"},e),{},{children:[Object(p.jsx)(P,{position:[-1,1,0],rotation:[0,0,t()]}),Object(p.jsx)(q,{position:[-1,3,0],rotation:[0,0,t()]}),Object(p.jsx)(P,{position:[0,1,1],rotation:[0,Math.PI/2,t()]}),Object(p.jsx)(q,{position:[0,3,1],rotation:[0,Math.PI/2,t()]}),Object(p.jsx)(W,{}),Object(p.jsx)(f,{})]}))}function L(e){var t=function(){return(Math.floor(8*Math.random())-4)*Math.PI};return Object(p.jsxs)("group",Object(h.a)(Object(h.a)({name:"wall-T"},e),{},{children:[Object(p.jsx)(P,{position:[-1,1,0],rotation:[0,0,t()]}),Object(p.jsx)(q,{position:[-1,3,0],rotation:[0,0,t()]}),Object(p.jsx)(P,{position:[1,1,0],rotation:[0,0,t()]}),Object(p.jsx)(q,{position:[1,3,0],rotation:[0,0,t()]}),Object(p.jsx)(P,{position:[0,1,1],rotation:[0,Math.PI/2,t()]}),Object(p.jsx)(q,{position:[0,3,1],rotation:[0,Math.PI/2,t()]}),Object(p.jsx)(W,{}),Object(p.jsx)(f,{})]}))}function N(e){var t=function(){return(Math.floor(8*Math.random())-4)*Math.PI};return Object(p.jsxs)("group",Object(h.a)(Object(h.a)({name:"wall-X"},e),{},{children:[Object(p.jsx)(P,{position:[-1,1,0],rotation:[0,0,t()]}),Object(p.jsx)(q,{position:[-1,3,0],rotation:[0,0,t()]}),Object(p.jsx)(P,{position:[1,1,0],rotation:[0,0,t()]}),Object(p.jsx)(q,{position:[1,3,0],rotation:[0,0,t()]}),Object(p.jsx)(P,{position:[0,1,1],rotation:[0,Math.PI/2,t()]}),Object(p.jsx)(q,{position:[0,3,1],rotation:[0,Math.PI/2,t()]}),Object(p.jsx)(P,{position:[0,1,-1],rotation:[0,Math.PI/2,t()]}),Object(p.jsx)(q,{position:[0,3,-1],rotation:[0,Math.PI/2,t()]}),Object(p.jsx)(W,{}),Object(p.jsx)(f,{})]}))}O.a.preload(I),O.a.preload(S),O.a.preload(B);var z,F="models/Statue_Horse.glb";function _(e){var t=Object(O.a)(F).nodes;return t.Pedestal.position.set(0,0,0),t.Horse.position.x=0,t.Horse.position.z=0,Object(p.jsxs)("group",Object(h.a)(Object(h.a)({name:"statue-horse"},e),{},{children:[Object(p.jsx)("primitive",{object:t.Scene.clone(),castShadow:!0,receiveShadow:!0}),Object(p.jsx)(f,{})]}))}O.a.preload(F),function(e){e[e.Void=0]="Void",e[e.Walkable=1]="Walkable",e[e.Blocked=2]="Blocked"}(z||(z={}));var Q={version:0,size:64,tiles:[]},A=[{id:"qd2-floor",physics:[z.Walkable,z.Walkable,z.Walkable,z.Walkable,z.Walkable,z.Walkable,z.Walkable,z.Walkable,z.Walkable],element:Object(p.jsx)(f,{}),tags:["Quaternius","Dungeon","Floor"]},{id:"qd2-wall",physics:[z.Walkable,z.Walkable,z.Walkable,z.Blocked,z.Blocked,z.Blocked,z.Walkable,z.Walkable,z.Walkable],element:Object(p.jsx)(C,{}),tags:["Quaternius","Dungeon","Wall"]},{id:"qd2-wall-with-column",physics:[z.Walkable,z.Walkable,z.Walkable,z.Blocked,z.Blocked,z.Blocked,z.Walkable,z.Walkable,z.Walkable],element:Object(p.jsx)(R,{}),tags:["Quaternius","Dungeon","Wall with Column"]},{id:"qd2-wall-corner",physics:[z.Walkable,z.Walkable,z.Walkable,z.Blocked,z.Blocked,z.Walkable,z.Walkable,z.Blocked,z.Walkable],element:Object(p.jsx)(E,{}),tags:["Quaternius","Dungeon","Wall","Corner"]},{id:"qd2-wall-T",physics:[z.Walkable,z.Walkable,z.Walkable,z.Blocked,z.Blocked,z.Blocked,z.Walkable,z.Blocked,z.Walkable],element:Object(p.jsx)(L,{}),tags:["Quaternius","Dungeon","Wall T"]},{id:"qd2-wall-X",physics:[z.Walkable,z.Blocked,z.Walkable,z.Blocked,z.Blocked,z.Blocked,z.Walkable,z.Blocked,z.Walkable],element:Object(p.jsx)(N,{}),tags:["Quaternius","Dungeon","Wall X"]},{id:"qd2-wall-broken",physics:[z.Walkable,z.Walkable,z.Walkable,z.Walkable,z.Blocked,z.Walkable,z.Walkable,z.Walkable,z.Walkable],element:Object(p.jsx)(D,{}),tags:["Quaternius","Dungeon","Wall Broken"]},{id:"qd2-arch",physics:[z.Walkable,z.Walkable,z.Walkable,z.Blocked,z.Walkable,z.Blocked,z.Walkable,z.Walkable,z.Walkable],element:Object(p.jsx)(k,{}),tags:["Quaternius","Dungeon","Arch"]},{id:"qd2-square-column",physics:[z.Walkable,z.Walkable,z.Walkable,z.Walkable,z.Blocked,z.Walkable,z.Walkable,z.Walkable,z.Walkable],element:Object(p.jsx)(y,{}),tags:["Quaternius","Dungeon","Square Column"]},{id:"qd2-round-column",physics:[z.Walkable,z.Walkable,z.Walkable,z.Walkable,z.Blocked,z.Walkable,z.Walkable,z.Walkable,z.Walkable],element:Object(p.jsx)(M,{}),tags:["Quaternius","Dungeon","Round Column"]},{id:"qd2-statue-horse",physics:[z.Walkable,z.Walkable,z.Walkable,z.Walkable,z.Blocked,z.Walkable,z.Walkable,z.Walkable,z.Walkable],element:Object(p.jsx)(_,{}),tags:["Quaternius","Dungeon","Statue","Horse"]}];function T(){return A.length}function H(e){return A.find((function(t){return t.id===e}))}function J(e){if(!(e<0||e>=A.length))return A[e]}a(63);function V(){var e=Object(b.f)().camera;return console.log(e.position,e.rotation),Object(p.jsx)(p.Fragment,{})}function X(e){var t=e.tileIndex,a=Object(b.f)().gl;return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("directionalLight",{}),Object(p.jsx)("ambientLight",{}),Object(p.jsx)("group",{onClick:function(){var e=document.createElement("a");e.href=a.domElement.toDataURL().replace("image/png","image/octet-stream"),e.download="".concat(J(t).id,".png"),e.click()},"position-y":-1,children:J(t).element}),Object(p.jsx)(V,{}),Object(p.jsx)(j.a,{})]})}function G(){var e=n.a.useState(0),t=Object(s.a)(e,2),a=t[0],o=t[1];return u((function(e){var t="keyup"===e.type;switch(e.key.toLowerCase()){case"escape":o(0);break;case"[":t&&a>0&&o(a-1);break;case"]":t&&a<T()-1&&o(a+1)}})),Object(p.jsxs)("div",{className:"container",children:[Object(p.jsx)("h1",{children:"Admin page"}),Object(p.jsx)("h2",{children:"Create tile preview bitmap"}),Object(p.jsx)("div",{className:"icon-preview",children:Object(p.jsx)(b.a,{gl:{preserveDrawingBuffer:!0},camera:{position:[-1.3,3.4,4.4],quaternion:new d.Quaternion(-.65,-.24,-.18)},children:Object(p.jsx)(X,{tileIndex:a})})}),Object(p.jsx)("p",{children:"Click on tile to download image"})]})}var K=a(73);function U(e){var t=e.level,a=e.gridSize,o=n.a.useMemo((function(){return t.tiles.map((function(e){var t;return Object(p.jsx)("group",{"position-x":e.x*a+a/2,"position-z":e.y*a+a/2,"rotation-y":-Math.PI/2*e.rotation,scale:[.25,.25,.25],children:null===(t=H(e.id))||void 0===t?void 0:t.element},"".concat(e.x,"x").concat(e.y))}))}),[t,a]);return Object(p.jsx)(p.Fragment,{children:o})}a(64);var Y=a(51),Z=a.n(Y);function $(){var e=n.a.useRef(),t=n.a.useState(-1),a=Object(s.a)(t,2),c=a[0],r=a[1],i=n.a.useState(0),d=Object(s.a)(i,2),h=d[0],O=d[1],x=n.a.useState(Q),f=Object(s.a)(x,2),m=f[0],k=f[1],v=Object(l.f)().level;n.a.useEffect((function(){fetch("levels/".concat(v||"default",".json")).then((function(e){return e.json()})).then((function(e){k(e)})).catch((function(e){console.log(e);var t=localStorage.getItem("untitled");t&&k(JSON.parse(t))}))}),[k,v]);u((function(e){var t="keyup"===e.type;switch(e.key.toLowerCase()){case"escape":r(-1);break;case"g":if(!t){var a=m.version,o=m.size,n=function(e){var t,a=[];try{t=Z()({width:e,height:e,retry:100,special:!0,room:{ideal:15,min_width:5,max_width:10,min_height:5,max_height:10}})}catch(O){return console.warn(O),[]}for(var o=[2,3,4],n=e/2,c=0;c<e;c++)for(var r=0;r<e;r++){var i=t.world[c][r],l=0!==c&&o.includes(t.world[c-1][r]),s=c!==e-1&&o.includes(t.world[c+1][r]),j=0!==r&&o.includes(t.world[c][r-1]),b=r!==e-1&&o.includes(t.world[c][r+1]),d=0;switch(l&&++d,s&&++d,j&&++d,b&&++d,i){case 0:break;case 1:a.push({id:"qd2-floor",x:r-n,y:c-n,rotation:0});break;case 2:var u=0,h="qd2-wall";4===d?h="qd2-wall-X":3===d&&(h="qd2-wall-T",u=l&&s?b?3:1:l?2:0),2===d&&(j||b?l&&b?(h="qd2-wall-corner",u=2):b&&s?(h="qd2-wall-corner",u=3):s&&j?(h="qd2-wall-corner",u=0):j&&l&&(h="qd2-wall-corner",u=1):u=1),a.push({id:h,x:r-n,y:c-n,rotation:u});break;case 3:case 4:a.push({id:"qd2-arch",x:r-n,y:c-n,rotation:l||s?1:0})}}return a}(o);k({version:a,size:o,tiles:n})}break;case"s":localStorage.setItem("untitled",JSON.stringify(m));break;case"r":t&&O((h+1)%4);break;case"[":t&&c>=0&&r(c-1);break;case"]":t&&c<T()-1&&r(c+1)}}));var g=1*m.size;return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("span",{className:"grid-pos"}),Object(p.jsx)(b.a,{shadowMap:!0,camera:{position:[8,5,0]},children:Object(p.jsxs)(o.Suspense,{fallback:null,children:[Object(p.jsx)(j.a,{maxPolarAngle:.5*Math.PI}),Object(p.jsx)(K.a,{}),Object(p.jsx)("directionalLight",{intensity:.4}),Object(p.jsx)("ambientLight",{intensity:.2}),Object(p.jsx)("gridHelper",{args:[g,m.size,2236962,4473924]}),Object(p.jsx)("axesHelper",{args:[g],"position-y":.01}),Object(p.jsx)(U,{gridSize:1,level:m}),Object(p.jsxs)("mesh",{name:"hidden-plane","rotation-x":-Math.PI/2,onPointerMove:function(t){var a=t.point;null===t||void 0===t||t.stopPropagation();var o=Math.floor(a.x/1),n=Math.floor(a.z/1);document.getElementsByClassName("grid-pos")[0].textContent="".concat(o,",").concat(n," / ").concat(a.x.toFixed(3),",").concat(a.z.toFixed(3)," / ").concat(h),e.current&&e.current.position.set(1*o+.5,0,1*n+.5)},onPointerDown:function(e){var t=e.point;null===e||void 0===e||e.stopPropagation();var a,o,n,i=Math.floor(t.x/1),l=Math.floor(t.z/1),s=(a=i,o=l,m.tiles.find((function(e){return e.x===a&&e.y===o})));if(e.shiftKey)return r(s?(n=s.id,A.findIndex((function(e){return e.id===n}))):-1),void(s&&O(s.rotation));var j=m.version,b=m.size,d=m.tiles.slice();s&&(-1!==c||e.ctrlKey)&&d.splice(d.indexOf(s),1),c>=0&&!e.ctrlKey&&d.push({id:J(c).id,x:i,y:l,rotation:h}),k({version:j,size:b,tiles:d})},children:[Object(p.jsx)("planeBufferGeometry",{args:[g,g]}),Object(p.jsx)("meshBasicMaterial",{visible:!1})]}),Object(p.jsxs)("group",{ref:e,name:"cursor-container",position:[.5,0,.5],children:[c>=0&&Object(p.jsx)("group",{scale:[.25,.25,.25],"rotation-y":-Math.PI/2*h,name:"tile-container",children:J(c).element}),Object(p.jsxs)("mesh",{name:"cursor","rotation-x":-Math.PI/2,"position-y":.01,children:[Object(p.jsx)("planeBufferGeometry",{args:[1,1,3,3]}),Object(p.jsx)("meshBasicMaterial",{color:4456448,wireframe:!0})]})]})]})})]})}a(70);function ee(){var e=n.a.useState([]),t=Object(s.a)(e,2),a=t[0],o=t[1],c=n.a.useState([]),r=Object(s.a)(c,2),l=r[0],j=r[1];n.a.useEffect((function(){fetch("levels/index.json").then((function(e){return e.json()})).then((function(e){return o(e)})).catch((function(e){}));try{var e=localStorage.getItem("saveList");j(e?JSON.parse(e):[{id:"untitled",description:"Default local map",author:"You?"}])}catch(t){console.warn("Failed to access LocalStorage for saved maps:",t)}}),[j,o]);return Object(p.jsxs)("div",{className:"container",children:[Object(p.jsx)("h1",{children:"DSEngine"}),Object(p.jsxs)("p",{children:["If you feel you created a cool map, click the download button below, and either create a Merge Request or send me an ",Object(p.jsx)("a",{href:"mailto:ithamar@game3dee.com?subject=DSEngine",children:"email"})," with the level file."]}),Object(p.jsx)("h3",{children:"Official levels"}),Object(p.jsx)("sub",{children:"These are the levels provided with DSEngine"}),Object(p.jsx)("div",{className:"Rtable Rtable--4cols",children:a.map((function(e){return Object(p.jsxs)("div",{children:[Object(p.jsx)("div",{className:"Rtable-cell",children:Object(p.jsx)("h3",{children:e.id})}),Object(p.jsx)("div",{className:"Rtable-cell",children:e.description},"".concat(e.id,"2")),Object(p.jsx)("div",{className:"Rtable-cell",children:e.author},"".concat(e.id,"3")),Object(p.jsxs)("div",{className:"Rtable-cell",children:[Object(p.jsx)(i.b,{to:"/edit/".concat(e.id),children:"Edit"})," /",Object(p.jsx)(i.b,{to:"/play/".concat(e.id),children:"Play"})]},"".concat(e.id,"4"))]},"".concat(e.id))}))}),Object(p.jsx)("h3",{children:"Local levels"}),Object(p.jsx)("sub",{children:"Levels created in this browser, only accessible by you"}),Object(p.jsx)("div",{className:"Rtable Rtable--4cols",children:l.map((function(e){return Object(p.jsxs)("div",{children:[Object(p.jsx)("div",{className:"Rtable-cell",children:Object(p.jsx)("h3",{children:e.id})}),Object(p.jsx)("div",{className:"Rtable-cell",children:e.description},"".concat(e.id,"2")),Object(p.jsx)("div",{className:"Rtable-cell",children:e.author},"".concat(e.id,"3")),Object(p.jsxs)("div",{className:"Rtable-cell",children:[Object(p.jsx)(i.b,{to:"/edit/".concat(e.id),children:"Edit"})," /",Object(p.jsx)(i.b,{to:"/play/".concat(e.id),children:"Play"})," /",Object(p.jsx)(i.b,{to:"",onClick:function(t){t.stopPropagation(),function(e){try{console.log("Download: ".concat(e));var t=localStorage.getItem(e);if(t){var a=document.createElement("a");a.href="data:text/plain,"+encodeURIComponent(t),a.download="".concat(e,".json"),a.click()}}catch(o){console.log("Download failed:",o)}}(e.id)},children:"Download"})]},"".concat(e.id,"4"))]},"".concat(e.id))}))})]})}var te=a(74),ae=a(75),oe=n.a.forwardRef((function(e,t){var a=e.animation,o=void 0===a?"Idle":a,c=e.character,r=void 0===c?"Warrior":c,i=Object(v.a)(e,["animation","character"]),l=Object(O.a)("npc/".concat(r,".glb")),j=l.animations,b=l.nodes,u=Object(te.a)(j),x=u.ref,f=u.actions,m=Object(ae.a)("npc/".concat(r,"_Texture.png"));m.wrapS=m.wrapT=d.RepeatWrapping;var k=n.a.useState(""),g=Object(s.a)(k,2),w=g[0],W=g[1];return b.Scene.traverse((function(e){if(e instanceof d.Mesh){var t=e;(Array.isArray(t.material)?t.material:[t.material]).forEach((function(e){e.map=m}))}})),n.a.useEffect((function(){o&&w!==o&&(w&&f[w].stop(),W(o),f[o].play())}),[f,w,W,o]),Object(p.jsxs)("group",Object(h.a)(Object(h.a)({name:"player"},i),{},{ref:t,children:[Object(p.jsx)("primitive",{ref:x,object:b.Scene}),i.children]}))}));a(71);function ne(e){var t=e.level,a=n.a.useRef(),o=n.a.useRef(),c=n.a.useRef(new d.Vector3),r=n.a.useRef(),i=n.a.useState("Idle"),l=Object(s.a)(i,2),j=l[0],h=l[1],O=n.a.useState(!1),x=Object(s.a)(O,2),f=x[0],m=x[1],k=192,v=t.size/2,g=n.a.useMemo((function(){var e=new Array(36864).fill(z.Void);return t.tiles.forEach((function(t){var a=3*(t.x+v),o=3*(t.y+v),n=H(t.id);if(n){for(var c=n.physics.slice(),r=0;r<t.rotation;r++){var i=c.slice();c[0]=i[6],c[1]=i[3],c[2]=i[0],c[3]=i[7],c[4]=i[4],c[5]=i[1],c[6]=i[8],c[7]=i[5],c[8]=i[2]}for(var l=o*k+a,s=0;s<3;s++)e[l+0]=c[3*s+0],e[l+1]=c[3*s+1],e[l+2]=c[3*s+2],l+=k}})),e}),[t.tiles,v,k]),w=n.a.useMemo((function(){var e=[];return g.forEach((function(t,a){if(t===z.Blocked){var o=a%k*1/3-v+1/3/2,n=1*Math.floor(a/k)/3-v+1/3/2;e.push(Object(p.jsxs)("mesh",{position:[o,1,n],children:[Object(p.jsx)("boxBufferGeometry",{args:[1/3,2,1/3]}),Object(p.jsx)("meshLambertMaterial",{color:"hotpink",transparent:!0,opacity:.5})]},a))}})),e}),[k,g]),W={left:!1,right:!1,forward:!1,backward:!1,attack:!1};return Object(b.d)((function(e){var t=e.camera;if(o.current&&r.current){r.current.getWorldPosition(c.current),t.position.lerp(c.current,.05);var a=o.current.position;if(t.lookAt(a.x,a.y+.5,a.z),W.left&&(o.current.rotation.y+=.005*Math.PI),W.right&&(o.current.rotation.y+=.005*-Math.PI),W.forward||W.backward){c.current.set(0,0,W.forward?.01:-.01),c.current.applyQuaternion(o.current.quaternion),c.current.add(o.current.position);var n=Math.floor((c.current.x+v)/(1/3)),i=Math.floor((c.current.z+v)/(1/3));g[i*k+n]===z.Walkable&&o.current.position.copy(c.current)}}})),u((function(e){var t="keydown"===e.type,a=.1,o=r.current;switch(e.key.toLowerCase()){case"arrowup":o&&(o.position.y-=a);break;case"arrowdown":o&&(o.position.y+=a);break;case"arrowleft":o&&(o.position.x-=a);break;case"arrowright":o&&(o.position.x+=a);break;case"1":o&&o.position.set(.7,13,-2);break;case"2":o&&o.position.set(.7,3,-2);break;case"w":W.forward=t,h(t?"Walk":"Idle");break;case"a":W.left=t;break;case"s":W.backward=t,h(t?"Walk":"Idle");break;case"d":W.right=t;break;case"escape":t&&m(!f);break;case"space":case" ":W.attack=t;break;default:console.log(e.key)}})),Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(K.a,{}),Object(p.jsx)("ambientLight",{intensity:.2}),Object(p.jsx)("directionalLight",{intensity:.4,position:[2.5,1,.4],ref:a,castShadow:!0}),Object(p.jsx)(U,{level:t,gridSize:1}),f&&w,Object(p.jsx)(oe,{animation:j,scale:[.2,.2,.2],position:[1.5,.06,.4],ref:o,children:Object(p.jsx)("group",{position:[.7,3,-2],ref:r})})]})}function ce(){var e=n.a.useState(Q),t=Object(s.a)(e,2),a=t[0],c=t[1],r=Object(l.f)().level;return n.a.useEffect((function(){fetch("levels/".concat(r||"default",".json")).then((function(e){return e.json()})).then((function(e){c(e)})).catch((function(e){console.log(e);var t=localStorage.getItem("untitled");t&&c(JSON.parse(t))}))}),[c,r]),Object(p.jsx)(b.a,{shadowMap:!0,camera:{position:[8,5,0]},className:"ingame",children:Object(p.jsx)(o.Suspense,{fallback:null,children:Object(p.jsx)(ne,{level:a})})})}function re(){return Object(p.jsx)(i.a,{children:Object(p.jsxs)(l.c,{children:[Object(p.jsx)(l.a,{exact:!0,path:"/",children:Object(p.jsx)(ee,{})}),Object(p.jsx)(l.a,{path:"/play/:level?",children:Object(p.jsx)(ce,{})}),Object(p.jsx)(l.a,{path:"/edit/:level?",children:Object(p.jsx)($,{})}),Object(p.jsx)(l.a,{path:"/admin",children:Object(p.jsx)(G,{})})]})})}var ie=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,78)).then((function(t){var a=t.getCLS,o=t.getFID,n=t.getFCP,c=t.getLCP,r=t.getTTFB;a(e),o(e),n(e),c(e),r(e)}))};r.a.render(Object(p.jsx)(n.a.StrictMode,{children:Object(p.jsx)(re,{})}),document.getElementById("root")),ie()}},[[72,1,2]]]);
//# sourceMappingURL=main.96a53eed.chunk.js.map