(this.webpackJsonpdsengine=this.webpackJsonpdsengine||[]).push([[0],{56:function(e,t,a){},62:function(e,t,a){},63:function(e,t,a){},69:function(e,t,a){},70:function(e,t,a){"use strict";a.r(t);var o=a(1),r=a.n(o),i=a(46),n=a.n(i),c=(a(56),a(26)),l=a(14),s=a(11),j=a(75),d=a(13),b=a(0),u=function(e){r.a.useEffect((function(){return document.addEventListener("keydown",e,!1),document.addEventListener("keyup",e,!1),function(){document.removeEventListener("keydown",e),document.removeEventListener("keyup",e)}}))},h=a(9),p=a(74),O=a(3),x="models/Floor_Modular.glb";function f(e){var t=Object(p.a)(x).nodes,a=function(){return(Math.floor(8*Math.random())-4)*Math.PI};return Object(O.jsxs)("group",Object(h.a)(Object(h.a)({name:"floor"},e),{},{children:[Object(O.jsx)("primitive",{object:t.Floor_Modular.clone(),position:[-1,-.08,-1],"rotation-y":a(),receiveShadow:!0}),Object(O.jsx)("primitive",{object:t.Floor_Modular.clone(),position:[1,-.08,-1],"rotation-y":a(),receiveShadow:!0}),Object(O.jsx)("primitive",{object:t.Floor_Modular.clone(),position:[-1,-.08,1],"rotation-y":a(),receiveShadow:!0}),Object(O.jsx)("primitive",{object:t.Floor_Modular.clone(),position:[1,-.08,1],"rotation-y":a(),receiveShaodw:!0})]}))}p.a.preload(x);var v="models/Arch.glb";function m(e){var t=Object(p.a)(v).nodes;return Object(O.jsxs)("group",Object(h.a)(Object(h.a)({name:"arch"},e),{},{children:[Object(O.jsx)("primitive",{object:t.Arch.clone(),castShadow:!0,receiveShadow:!0}),Object(O.jsx)(f,{})]}))}p.a.preload(v);var k,w="models/Wall_Modular.glb";function g(e){var t=Object(p.a)(w).nodes,a=function(){return(Math.floor(8*Math.random())-4)*Math.PI};return Object(O.jsxs)("group",Object(h.a)(Object(h.a)({name:"wall"},e),{},{children:[Object(O.jsx)("primitive",{object:t.Wall_Modular.clone(),position:[-1,1,0],"rotation-z":a(),castShadow:!0,receiveShadow:!0}),Object(O.jsx)("primitive",{object:t.Wall_Modular.clone(),position:[-1,3,0],"rotation-z":a(),castShadow:!0,receiveShadow:!0}),Object(O.jsx)("primitive",{object:t.Wall_Modular.clone(),position:[1,1,0],"rotation-z":a(),castShadow:!0,receiveShadow:!0}),Object(O.jsx)("primitive",{object:t.Wall_Modular.clone(),position:[1,3,0],"rotation-z":a(),castShadow:!0,receiveShadow:!0}),Object(O.jsx)(f,{})]}))}function M(e){var t=Object(p.a)(w).nodes,a=function(){return(Math.floor(8*Math.random())-4)*Math.PI};return Object(O.jsxs)("group",Object(h.a)(Object(h.a)({name:"wall-corner"},e),{},{children:[Object(O.jsx)("primitive",{object:t.Wall_Modular.clone(),position:[-1,1,0],"rotation-z":a(),castShadow:!0,receiveShadow:!0}),Object(O.jsx)("primitive",{object:t.Wall_Modular.clone(),position:[-1,3,0],"rotation-z":a(),castShadow:!0,receiveShadow:!0}),Object(O.jsx)("primitive",{object:t.Wall_Modular.clone(),position:[0,1,1],rotation:[0,Math.PI/2,a()],castShadow:!0,receiveShadow:!0}),Object(O.jsx)("primitive",{object:t.Wall_Modular.clone(),position:[0,3,1],rotation:[0,Math.PI/2,a()],castShadow:!0,receiveShadow:!0}),Object(O.jsx)(f,{})]}))}function S(e){var t=Object(p.a)(w).nodes,a=function(){return(Math.floor(8*Math.random())-4)*Math.PI};return Object(O.jsxs)("group",Object(h.a)(Object(h.a)({name:"wall-T"},e),{},{children:[Object(O.jsx)("primitive",{object:t.Wall_Modular.clone(),position:[-1,1,0],"rotation-z":a(),castShadow:!0,receiveShadow:!0}),Object(O.jsx)("primitive",{object:t.Wall_Modular.clone(),position:[-1,3,0],"rotation-z":a(),castShadow:!0,receiveShadow:!0}),Object(O.jsx)("primitive",{object:t.Wall_Modular.clone(),position:[1,1,0],"rotation-z":a(),castShadow:!0,receiveShadow:!0}),Object(O.jsx)("primitive",{object:t.Wall_Modular.clone(),position:[1,3,0],"rotation-z":a(),castShadow:!0,receiveShadow:!0}),Object(O.jsx)("primitive",{object:t.Wall_Modular.clone(),position:[0,1,1],rotation:[0,Math.PI/2,a()],castShadow:!0,receiveShadow:!0}),Object(O.jsx)("primitive",{object:t.Wall_Modular.clone(),position:[0,3,1],rotation:[0,Math.PI/2,a()],castShadow:!0,receiveShadow:!0}),Object(O.jsx)(f,{})]}))}function W(e){var t=Object(p.a)(w).nodes,a=function(){return(Math.floor(8*Math.random())-4)*Math.PI};return Object(O.jsxs)("group",Object(h.a)(Object(h.a)({name:"wall-T"},e),{},{children:[Object(O.jsx)("primitive",{object:t.Wall_Modular.clone(),position:[-1,1,0],"rotation-z":a(),castShadow:!0,receiveShadow:!0}),Object(O.jsx)("primitive",{object:t.Wall_Modular.clone(),position:[-1,3,0],"rotation-z":a(),castShadow:!0,receiveShadow:!0}),Object(O.jsx)("primitive",{object:t.Wall_Modular.clone(),position:[1,1,0],"rotation-z":a(),castShadow:!0,receiveShadow:!0}),Object(O.jsx)("primitive",{object:t.Wall_Modular.clone(),position:[1,3,0],"rotation-z":a(),castShadow:!0,receiveShadow:!0}),Object(O.jsx)("primitive",{object:t.Wall_Modular.clone(),position:[0,1,1],rotation:[0,Math.PI/2,a()],castShadow:!0,receiveShadow:!0}),Object(O.jsx)("primitive",{object:t.Wall_Modular.clone(),position:[0,3,1],rotation:[0,Math.PI/2,a()],castShadow:!0,receiveShadow:!0}),Object(O.jsx)("primitive",{object:t.Wall_Modular.clone(),position:[0,1,-1],rotation:[0,Math.PI/2,a()],castShadow:!0,receiveShadow:!0}),Object(O.jsx)("primitive",{object:t.Wall_Modular.clone(),position:[0,3,-1],rotation:[0,Math.PI/2,a()],castShadow:!0,receiveShadow:!0}),Object(O.jsx)(f,{})]}))}p.a.preload(w),function(e){e[e.Void=0]="Void",e[e.Walkable=1]="Walkable",e[e.Blocked=2]="Blocked"}(k||(k={}));var y=[{id:"qd2-floor",physics:[k.Walkable,k.Walkable,k.Walkable,k.Walkable,k.Walkable,k.Walkable,k.Walkable,k.Walkable,k.Walkable],element:Object(O.jsx)(f,{}),tags:["Quaternius","Dungeon","Floor"]},{id:"qd2-wall",physics:[k.Walkable,k.Walkable,k.Walkable,k.Blocked,k.Blocked,k.Blocked,k.Walkable,k.Walkable,k.Walkable],element:Object(O.jsx)(g,{}),tags:["Quaternius","Dungeon","Wall"]},{id:"qd2-wall-corner",physics:[k.Walkable,k.Blocked,k.Walkable,k.Walkable,k.Blocked,k.Blocked,k.Walkable,k.Walkable,k.Walkable],element:Object(O.jsx)(M,{}),tags:["Quaternius","Dungeon","Wall","Corner"]},{id:"qd2-wall-T",physics:[k.Walkable,k.Walkable,k.Walkable,k.Blocked,k.Blocked,k.Blocked,k.Walkable,k.Blocked,k.Walkable],element:Object(O.jsx)(S,{}),tags:["Quaternius","Dungeon","Wall T"]},{id:"qd2-wall-X",physics:[k.Walkable,k.Blocked,k.Walkable,k.Blocked,k.Blocked,k.Blocked,k.Walkable,k.Blocked,k.Walkable],element:Object(O.jsx)(W,{}),tags:["Quaternius","Dungeon","Wall X"]},{id:"qd2-arch",physics:[k.Walkable,k.Walkable,k.Walkable,k.Blocked,k.Walkable,k.Blocked,k.Walkable,k.Walkable,k.Walkable],element:Object(O.jsx)(m,{}),tags:["Quaternius","Dungeon","Arch"]}];function I(){return y.length}function B(e){return y.find((function(t){return t.id===e}))}function P(e){if(!(e<0||e>=y.length))return y[e]}a(62);function _(){var e=Object(d.f)(),t=e.camera;e.gl;return console.log(t.position,t.rotation),Object(O.jsx)(O.Fragment,{})}function z(e){var t=e.tileIndex,a=Object(d.f)().gl;return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("directionalLight",{}),Object(O.jsx)("ambientLight",{}),Object(O.jsx)("group",{onClick:function(){var e=document.createElement("a");e.href=a.domElement.toDataURL().replace("image/png","image/octet-stream"),e.download="".concat(P(t).id,".png"),e.click()},"position-y":-1,children:P(t).element}),Object(O.jsx)(_,{}),Object(O.jsx)(j.a,{})]})}function F(){var e=r.a.useState(0),t=Object(s.a)(e,2),a=t[0],o=t[1];return u((function(e){var t="keyup"===e.type;switch(e.key.toLowerCase()){case"escape":o(0);break;case"[":t&&a>0&&o(a-1);break;case"]":t&&a<I()-1&&o(a+1)}})),Object(O.jsxs)("div",{className:"container",children:[Object(O.jsx)("h1",{children:"Admin page"}),Object(O.jsx)("h2",{children:"Create tile preview bitmap"}),Object(O.jsx)("div",{className:"icon-preview",children:Object(O.jsx)(d.a,{gl:{preserveDrawingBuffer:!0},camera:{position:[-1.3,3.4,4.4],quaternion:new b.Quaternion(-.65,-.24,-.18)},children:Object(O.jsx)(z,{tileIndex:a})})}),Object(O.jsx)("p",{children:"Click on tile to download image"})]})}var L=a(71);function E(e){var t=e.level,a=e.gridSize,o=t.tiles.map((function(e){var t;return Object(O.jsx)("group",{"position-x":e.x*a+a/2,"position-z":e.y*a+a/2,"rotation-y":-Math.PI/2*e.rotation,scale:[.25,.25,.25],children:null===(t=B(e.id))||void 0===t?void 0:t.element},"".concat(e.x,"x").concat(e.y))}));return Object(O.jsx)(O.Fragment,{children:o})}a(63);var C={version:0,size:64,tiles:[]};function D(){var e=r.a.useRef(),t=r.a.useState(-1),a=Object(s.a)(t,2),i=a[0],n=a[1],c=r.a.useState(0),l=Object(s.a)(c,2),b=l[0],h=l[1],p=r.a.useState(C),x=Object(s.a)(p,2),f=x[0],v=x[1];r.a.useEffect((function(){var e=localStorage.getItem("untitled");if(e){var t=JSON.parse(e);v(t)}}),[v]);u((function(e){var t="keyup"===e.type;switch(e.key.toLowerCase()){case"escape":n(-1);break;case"s":localStorage.setItem("untitled",JSON.stringify(f));break;case"r":t&&h((b+1)%4);break;case"[":t&&i>=0&&n(i-1);break;case"]":t&&i<I()-1&&n(i+1)}}));var m=1*f.size;return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("span",{className:"grid-pos"}),Object(O.jsx)(d.a,{shadowMap:!0,camera:{position:[8,5,0]},children:Object(O.jsxs)(o.Suspense,{fallback:null,children:[Object(O.jsx)(j.a,{maxPolarAngle:.5*Math.PI}),Object(O.jsx)(L.a,{}),Object(O.jsx)("directionalLight",{intensity:.4}),Object(O.jsx)("ambientLight",{intensity:.2}),Object(O.jsx)("gridHelper",{args:[m,f.size,2236962,4473924]}),Object(O.jsx)("axesHelper",{args:[m],"position-y":.01}),Object(O.jsx)(E,{gridSize:1,level:f}),Object(O.jsxs)("mesh",{name:"hidden-plane","rotation-x":-Math.PI/2,onPointerMove:function(t){var a=t.point;null===t||void 0===t||t.stopPropagation();var o=Math.floor(a.x/1),r=Math.floor(a.z/1);document.getElementsByClassName("grid-pos")[0].textContent="".concat(o,",").concat(r," / ").concat(a.x.toFixed(3),",").concat(a.z.toFixed(3)," / ").concat(b),e.current&&e.current.position.set(1*o+.5,0,1*r+.5)},onPointerDown:function(e){var t=e.point;null===e||void 0===e||e.stopPropagation();var a,o,r,c=Math.floor(t.x/1),l=Math.floor(t.z/1),s=(a=c,o=l,f.tiles.find((function(e){return e.x===a&&e.y===o})));if(e.shiftKey)return n(s?(r=s.id,y.findIndex((function(e){return e.id===r}))):-1),void(s&&h(s.rotation));var j=f.version,d=f.size,u=f.tiles.slice();s&&(-1!==i||e.ctrlKey)&&u.splice(u.indexOf(s),1),i>=0&&!e.ctrlKey&&u.push({id:P(i).id,x:c,y:l,rotation:b}),v({version:j,size:d,tiles:u})},children:[Object(O.jsx)("planeBufferGeometry",{args:[m,m]}),Object(O.jsx)("meshBasicMaterial",{visible:!1})]}),Object(O.jsxs)("group",{ref:e,name:"cursor-container",position:[.5,0,.5],children:[i>=0&&Object(O.jsx)("group",{scale:[.25,.25,.25],"rotation-y":-Math.PI/2*b,name:"tile-container",children:P(i).element}),Object(O.jsxs)("mesh",{name:"cursor","rotation-x":-Math.PI/2,"position-y":.01,children:[Object(O.jsx)("planeBufferGeometry",{args:[1,1,3,3]}),Object(O.jsx)("meshBasicMaterial",{color:4456448,wireframe:!0})]})]})]})})]})}function R(){return Object(O.jsx)("div",{children:Object(O.jsxs)("ul",{children:[Object(O.jsx)("li",{children:Object(O.jsx)(c.b,{to:"/",children:"Home"})}),Object(O.jsx)("li",{children:Object(O.jsx)(c.b,{to:"/play",children:"Play"})}),Object(O.jsx)("li",{children:Object(O.jsx)(c.b,{to:"/edit",children:"Edit"})})]})})}var A=a(72),q=a(73),N="npc/Rogue.glb",Q=r.a.forwardRef((function(e,t){var a=Object(p.a)(N),o=a.animations,i=a.nodes,n=Object(A.a)(o),c=n.ref,l=n.actions,j=Object(q.a)("npc/Rogue_Texture.png");j.wrapS=j.wrapT=b.RepeatWrapping;var d=r.a.useState(""),u=Object(s.a)(d,2),x=u[0],f=u[1];return i.Scene.traverse((function(e){if(e instanceof b.Mesh){var t=e;(Array.isArray(t.material)?t.material:[t.material]).forEach((function(e){e.map=j}))}})),r.a.useEffect((function(){e.animation&&x!==e.animation&&(x&&l[x].stop(),f(e.animation),l[e.animation].play())}),[l,x,f,e.animation]),Object(O.jsxs)("group",Object(h.a)(Object(h.a)({name:"player"},e),{},{ref:t,children:[Object(O.jsx)("primitive",{ref:c,object:i.Scene}),e.children]}))}));p.a.preload(N);a(69);function T(e){var t=e.level,a=r.a.useRef(),o=r.a.useRef(),i=r.a.useRef(new b.Vector3),n=r.a.useRef(),c=r.a.useState("Idle"),l=Object(s.a)(c,2),j=l[0],h=l[1],p=192,x=r.a.useMemo((function(){var e=new Array(36864).fill(k.Void);return t.tiles.forEach((function(t){var a=3*(t.x+32),o=3*(t.y+32),r=B(t.id);if(r){for(var i=r.physics.slice(),n=0;n<t.rotation;n++){var c=i.slice();i[0]=c[6],i[1]=c[3],i[2]=c[0],i[3]=c[7],i[4]=c[4],i[5]=c[1],i[6]=c[8],i[7]=c[5],i[8]=c[2]}for(var l=o*p+a,s=0;s<3;s++)e[l+0]=i[3*s+0],e[l+1]=i[3*s+1],e[l+2]=i[3*s+2],l+=p}})),e}),[t.tiles,p]),f=(r.a.useMemo((function(){var e=[];return x.forEach((function(t,a){if(t===k.Blocked){var o=a%p*1/3-32+1/3/2,r=1*Math.floor(a/p)/3-32+1/3/2;e.push(Object(O.jsxs)("mesh",{position:[o,1,r],children:[Object(O.jsx)("boxBufferGeometry",{args:[1/3,2,1/3]}),Object(O.jsx)("meshLambertMaterial",{color:"hotpink"})]},a))}})),e}),[p,x]),{left:!1,right:!1,forward:!1,backward:!1,attack:!1});Object(d.d)((function(e){var t=e.camera;if(o.current&&n.current){n.current.getWorldPosition(i.current),t.position.lerp(i.current,.05);var a=o.current.position;if(t.lookAt(a.x,a.y+.5,a.z),f.left&&(o.current.rotation.y+=.005*Math.PI),f.right&&(o.current.rotation.y+=.005*-Math.PI),f.forward||f.backward){i.current.set(0,0,f.forward?.01:-.01),i.current.applyQuaternion(o.current.quaternion),i.current.add(o.current.position);var r=Math.floor((i.current.x+32)/(1/3)),c=Math.floor((i.current.z+32)/(1/3));console.log(Math.floor(r/3)-32,Math.floor(c/3)-32,r%3,c%3),o.current.position.copy(i.current)}}})),u((function(e){var t="keydown"===e.type;switch(e.key.toLowerCase()){case"arrowup":case"arrowdown":case"arrowleft":case"arrowright":break;case"w":f.forward=t,h(t?"Walk":"Idle");break;case"a":f.left=t;break;case"s":f.backward=t,h(t?"Walk":"Idle");break;case"d":f.right=t;break;case"c":break;case"space":case" ":f.attack=t;break;default:console.log(e.key)}}));var v=r.a.useMemo((function(){return Object(O.jsx)(E,{level:t,gridSize:1})}),[t]);return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(L.a,{}),Object(O.jsx)("ambientLight",{intensity:.1}),Object(O.jsx)("directionalLight",{intensity:.4,position:[2.5,1,.4],ref:a}),v,Object(O.jsx)(Q,{animation:j,scale:[.25,.25,.25],position:[1.5,.06,.4],ref:o,children:Object(O.jsx)("group",{position:[.7,3,-3],ref:n})})]})}function J(){var e=JSON.parse(localStorage.getItem("untitled"));return Object(O.jsx)(d.a,{shadowMap:!0,camera:{position:[8,5,0]},className:"ingame",children:Object(O.jsx)(o.Suspense,{fallback:null,children:Object(O.jsx)(T,{level:e})})})}function V(){return Object(O.jsx)(c.a,{children:Object(O.jsxs)(l.c,{children:[Object(O.jsx)(l.a,{exact:!0,path:"/",children:Object(O.jsx)(R,{})}),Object(O.jsx)(l.a,{path:"/play",children:Object(O.jsx)(J,{})}),Object(O.jsx)(l.a,{path:"/edit",children:Object(O.jsx)(D,{})}),Object(O.jsx)(l.a,{path:"/admin",children:Object(O.jsx)(F,{})})]})})}var G=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,76)).then((function(t){var a=t.getCLS,o=t.getFID,r=t.getFCP,i=t.getLCP,n=t.getTTFB;a(e),o(e),r(e),i(e),n(e)}))};n.a.render(Object(O.jsx)(r.a.StrictMode,{children:Object(O.jsx)(V,{})}),document.getElementById("root")),G()}},[[70,1,2]]]);
//# sourceMappingURL=main.f186b068.chunk.js.map